//Ejercicio NÂ°2:

//A)

global int[N] bicicleteros = [5,5,...,5]; //Indexeado de 0 a N-1

global Semaphore[N] puedeDejar = new Semaphore(5);
global Semaphore[N] puedeTomar = new Semaphore(5);
global Semaphore[N] mutexBicicleta = new Semaphore(1);

thread Persona(puntoSalida, puntoDestino):{
  puedeTomar[puntoSalida].acquire();
  mutexBicicleta[puntoSalida].acquire();
  bicicleteros[puntoSalida]--;
  mutexBicicleta[puntoSalida].release();
  puedeDejar[puntoSalida].release();

  //Viaja del puntoSalida al puntoDestino

  puedeDejar[puntoDestino].acquire();
  mutexBicicleta[puntoDestino].acquire();
  bicicleteros[puntoDestino]++;
  mutexBicicleta[puntoDestino].release();
  puedeTomar[puntoDestino].release();
}

//B)

global int[N] bicicleteros[10] = [[],[],...,[]];
global int bicicletasTotales = 5N;
global int bicicletas[5N] = [0,1,...,5N-1];

global Semaphore[N] puedeDejar = new Semaphore(5);
global Semaphore[N] puedeTomar = new Semaphore(0);
global Semaphore[N] mutexBicicleta = new Semaphore(1);

thread Camion():{
  while(bicicletasTotales>0){
    int destino = random(0,N-1);
    repeat(5){
      puedeDejar[destino].acquire();
      mutexBicicleta[destino].acquire();
      int j = 0;
      while(bicicleteros[destino][j] != NULL) {j++;}
      bicicletas[destino][j] = bicicletas[0];
      local[bicicletasTotales - 1 ];
      for(i=0;i++;i<bicicletasTotales){
        local[i] = bicicletas[i];
      }
      bicicletas = local;
      bicletasTotales--;
      mutexBicicleta[destino].release();
    }
  }
}

thread Persona(puntoSalida, puntoDestino):{
  puedeTomar[puntoSalida].acquire();
  mutexBicicleta[puntoSalida].acquire();
  int k = 0;
  while(bicicleteros[puntoSalida][k] != NULL) {k++;}
  int miBicicleta = bicicleteros[puntoSalida][k];
  bicicleteros[puntoSalida][k] = NULL;
  mutexBicicleta[puntoSalida].release();
  puedeDejar[puntoSalida].release();

  //Viaja del puntoSalida al puntoDestino
  print(f"Viajo del bicicletero {puntoSalida} al bicicletero {puntoDestino} en la bicicleta {miBicicleta}";

  puedeDejar[puntoDestino].acquire();
  mutexBicicleta[puntoDestino].acquire();
  k = 0;
  while(bicicleteros[puntoDestino][k] != NULL) {k++;}
  bicicleteros[puntoDestino][k] = miBicicleta;
  miBicicleta = NULL;
  mutexBicicleta[puntoDestino].release();
  puedeTomar[puntoDestino].release();
}
